(function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;cola.ext={},a=function(a,b){var c,d,e,f,g,h,i,j;if(null!=a?a._columns:void 0)for(j=a._columns,f=0,h=j.length;h>f;f++)c=j[f],c._setTable(null);if(e=[],b)for(g=0,i=b.length;i>g;g++)d=b[g],d&&(d instanceof cola.TableColumn?c=d:(c=cola.create("table.column",d,cola.TableColumn),c.set("width",d.width)),c._setTable(a),e.push(c));this._columns=e},cola.ext.AbstractTable=function(c){function d(a){this._columnMap={},d.__super__.constructor.call(this,a)}return b(d,c),d.attributes={items:{refreshItems:!0,setter:function(a){this._items!==a&&(this._set("bind",void 0),this._items=a)}},bind:{setter:function(a){this._set("items",void 0),this._bindSetter(a)}},columns:{setter:function(b){a.call(this,this,b),this._collectionColumnsInfo()}},dataType:{setter:cola.DataType.dataTypeSetter},showHeader:{type:"boolean",defaultValue:!0},showFooter:{type:"boolean"},columnStrecthable:{type:"boolean",defaultValue:!0},selectedProperty:{defaultValue:"selected"}},d.EVENTS={renderRow:null,renderCell:null,renderHeaderCell:null,renderFooterCell:null},d.TEMPLATES={"default":{tagName:"tr"},"checkbox-column":{tagName:"div","c-widget":"checkbox;class:in-cell;bind:$default"},"input-column":{tagName:"div","c-widget":"input;class:in-cell;bind:$default",style:{width:"100%"}},"group-header":{tagName:"tr",content:{tagName:"td",colSpan:100}}},d.prototype._getItems=function(){return this._items?{items:this._items}:d.__super__._getItems.call(this)},d.prototype._regColumn=function(a){a._name&&(this._columnMap[a._name]=a)},d.prototype._unregColumn=function(a){a._name&&delete this._columnMap[a._name]},d.prototype.getColumn=function(a){return this._columnMap[a]},d.prototype._collectionColumnsInfo=function(){var a,b,c,d,e,f,g;if(b=function(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p;if(i={level:d,column:a},a instanceof cola.TableGroupColumn){if(a._columns){for(i.columns=g=[],m=a._columns,j=0,k=m.length;k>j;j++)f=m[j],f._visible&&(c.rows.length===d&&(c.rows[d]=[]),g.push(b(f,c,d+1)));g.length&&(c.rows.length===d&&(c.rows[d]=[]),c.rows[d].push(i))}}else a._bind&&(e=a._bind,46===e.charCodeAt(0)?(h=e.indexOf("|"),0>h?i.property=e.substring(1):(i.property=e.substring(1,h),i.expression=cola._compileExpression(c.alias+e))):(i.expression=cola._compileExpression(e),l=null!=(n=i.expression)?n.path:void 0,l instanceof Array&&(l=l[0]),l&&l.indexOf("*")<0&&(i.property=l))),a._width&&(o=a._width,"string"==typeof o&&(o.indexOf("px")>0?p="px":o.indexOf("%")>0&&(p="percent")),i.widthType=p,i.width=parseInt(o,10),!p&&i.width&&(c.totalWidth+=i.width)),i.index=c.dataColumns.length,c.dataColumns.push(i),a instanceof cola.TableSelectColumn&&(null==c.selectColumns&&(c.selectColumns=[]),c.selectColumns.push(i)),c.rows.length===d&&(c.rows[d]=[]),c.rows[d].push(i);return i},this._columnsInfo=c={totalWidth:0,rows:[[]],dataColumns:[],alias:"item"},this._columns)for(d=this._itemsScope.expression,d&&(c.alias=d.alias),g=this._columns,e=0,f=g.length;f>e;e++)a=g[e],a._visible&&b(a,c,0)},d.prototype._getBindDataType=function(){var a,b,c;return this._dataType?this._dataType:(c=this._getItems().originItems,c&&(c instanceof cola.EntityList?a=c.dataType:c instanceof Array&&c.length&&(b=c[0],b&&b instanceof cola.Entity&&(a=b.dataType))),this._dataType=a)},d.prototype._createDom=function(){var a;return null==this._doms&&(this._doms={}),a=document.createElement("table"),this._createInnerDom(a),a},d.prototype._createInnerDom=function(a){"TABLE"===a.nodeName?$fly(a).xAppend([{tagName:"tbody","class":"list",contextKey:"itemsWrapper"}],this._doms):$fly(a).xAppend({tagName:"table",content:[{tagName:"tbody","class":"list",contextKey:"itemsWrapper"}]},this._doms),this._doms.tbody=this._doms.itemsWrapper},d.prototype._parseDom=function(a){var b,c,d;if(a){for(null==this._doms&&(this._doms={}),b=a.firstChild;b;)c=b.nextSibling,d=b.nodeName,"TEMPLATE"===d?this._regTemplate(b):a.removeChild(b),b=c;this._createInnerDom(a)}},d.prototype._createNewItem=function(a,b){var c,d;return d=this._getTemplate(a),c=this._cloneTemplate(d),$fly(c).addClass("item "+a),c._itemType=a,c},d.prototype._refreshEmptyItemDom=function(){},d}(cola.ItemsView),cola.ext.Table=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.CLASS_NAME="table",c.prototype._initDom=function(a){c.__super__._initDom.call(this,a),$fly(window).resize(function(a){return function(){var b,c;a._fixedHeaderVisible&&(c=a._getFixedHeader(),$fly(c).width(a._doms.itemsWrapper.clientWidth)),a._fixedFooterVisible&&(b=a._getFixedFooter(),$fly(b).width(a._doms.itemsWrapper.clientWidth))}}(this))},c.prototype._doRefreshItems=function(){var a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(!this._columnsInfo.dataColumns.length&&this._dataType&&this._dataType instanceof cola.EntityDataType){for(f=[],o=this._dataType.getProperties().elements,i=0,k=o.length;k>i;i++)n=o[i],f.push({bind:n._property});this.set("columns",f)}for(q=this._doms.tbody,this._showHeader&&(s=this._doms.thead,s||($fly(q).xInsertBefore({tagName:"thead",contextKey:"thead"},this._doms),s=this._doms.thead),this._refreshHeader(s)),d=s.firstChild,m=d.firstChild,p=this._columnsInfo.dataColumns,h=j=0,l=p.length;l>j;h=++j)b=p[h],a=m,g=a.firstChild,m=a.nextSibling,"precent"===b.widthType?t=b.width+"%":b.widthType?t=b.width+b.widthType:b.width&&(t=100*b.width/this._columnsInfo.totalWidth+"%"),null!=t&&($fly(g).width(t),$fly(a).width(t),t=null),e=b.column,a.valign=e._valign||"";for(a=m;a;)m=a.nextSibling,d.removeChild(a),a=m;c.__super__._doRefreshItems.call(this,q),this._showFooter&&(r=this._doms.tfoot,r||($fly(q).xInsertAfter({tagName:"tfoot",contextKey:"tfoot"},this._doms),r=this._doms.tfoot),this._refreshFooter(r),this._fixedFooterVisible||(this._showFooterTimer=setInterval(function(a){return function(){var b;b=a._doms.itemsWrapper,b.scrollHeight&&a._refreshFixedFooter(300)}}(this),300)))},c.prototype._onItemInsert=function(a){c.__super__._onItemInsert.call(this,a),this._columnsInfo.selectColumns&&cola.util.delay(this,"refreshHeaderCheckbox",100,function(a){return function(){var b,c,d,e;for(e=a._columnsInfo.selectColumns,c=0,d=e.length;d>c;c++)b=e[c],b.column.refreshHeaderCheckbox()}}(this))},c.prototype._onItemRemove=function(a){c.__super__._onItemRemove.call(this,a),this._showFooter&&this._refreshFixedFooter(),this._columnsInfo.selectColumns&&cola.util.delay(this,"refreshHeaderCheckbox",100,function(a){return function(){var b,c,d,e;for(e=a._columnsInfo.selectColumns,c=0,d=e.length;d>c;c++)b=e[c],b.column.refreshHeaderCheckbox()}}(this))},c.prototype._refreshHeader=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;for(f=null,o=this._columnsInfo.rows,g=0,k=o.length;k>g;){for(m=a.rows[g],m||(m=$.xCreate({tagName:"tr"}),null==f&&(f=document.createDocumentFragment()),f.appendChild(m)),n=o[g],i=j=0,l=n.length;l>j;i=++j){for(c=n[i],d=c.column,b=m.cells[i];b&&b._name!==d._name;)m.removeChild(b),b=m.cells[i];b||(h=!0,b=$.xCreate({"class":"center aligned",tagName:"th",content:{tagName:"div"}}),b._name=d._name,m.appendChild(b)),b._index=c.index,c.columns?(b.rowSpan=1,b.colSpan=c.columns.length):(b.rowSpan=k-g,b.colSpan=1),e=b.firstChild,this._refreshHeaderCell(e,c,h)}for(;m.lastChild!==b;)m.removeChild(m.lastChild);g++}for(;m.lastChild!==b;)m.removeChild(m.lastChild);for(cola.xRender(m,this._scope),f&&a.appendChild(f);a.lastChild!==m;)a.removeChild(a.lastChild)},c.prototype._refreshHeaderCell=function(a,b,c){var d,e,f,g,h,i;e=b.column,e.renderHeader&&e.renderHeader(a)!==!0||e.getListeners("renderHeader")&&e.fire("renderHeader",e,{dom:a})===!1||this.getListeners("renderHeaderCell")&&this.fire("renderHeaderCell",this,{column:e,dom:a})===!1||(c&&(h=e._realHeaderTemplate,void 0===h&&(i=e._headerTemplate,i&&(h=this._getTemplate(i)),e._realHeaderTemplate=h||null),h&&(h=this._cloneTemplate(h),a.appendChild(h))),e._realHeaderTemplate||(f=this._getBindDataType(),f&&b.property&&(g=f.getProperty(b.property)),d=e._caption||(null!=g?g._caption:void 0),d||(d=e._name,95===(null!=d?d.charCodeAt(0):void 0)&&(d=e._bind)),a.innerText=d||""))},c.prototype._refreshFooter=function(a){var b,c,d,e,f,g,h,i,j,k;for(d=this._columnsInfo.dataColumns,k=a.rows[0],k||(k=document.createElement("tr")),g=i=0,j=d.length;j>i;g=++i){for(c=d[g],e=c.column,b=k.cells[g];b&&b._name!==e._name;)k.removeChild(b),b=k.cells[g];b||(h=!0,b=$.xCreate({tagName:"td",content:{tagName:"div"}}),b._name=e._name,k.appendChild(b)),f=b.firstChild,this._refreshFooterCell(f,c,h)}for(;k.lastChild!==b;)k.removeChild(k.lastChild);cola.xRender(k,this._scope),a.rows.length<1&&a.appendChild(k)},c.prototype._refreshFooterCell=function(a,b,c){var d,e,f;d=b.column,d.renderFooter&&d.renderFooter(a)!==!0||d.getListeners("renderFooter")&&d.fire("renderFooter",d,{dom:a})===!1||this.getListeners("renderFooterCell")&&this.fire("renderFooterCell",this,{column:d,dom:a})===!1||(c&&(e=d._realFooterTemplate,void 0===e&&(f=d._footerTemplate,f&&(e=this._getTemplate(f)),d._realFooterTemplate=e||null),e&&(e=this._cloneTemplate(e),a.appendChild(e))),d._realFooterTemplate||(a.innerHTML="&nbsp;"))},c.prototype._doRefreshItemDom=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;if(k=a._itemType,(!this.getListeners("renderRow")||this.fire("renderRow",this,{item:b,dom:a,scope:c})!==!1)&&"default"===k){for(f=this._columnsInfo.dataColumns,i=l=0,m=f.length;m>l;i=++l){for(e=f[i],g=e.column,d=a.cells[i];d&&d._name!==g._name;)a.removeChild(d),d=a.cells[i];d||(j=!0,d=$.xCreate({tagName:"td",content:{tagName:"div"}}),d._name=g._name,a.appendChild(d)),h=d.firstChild,this._refreshCell(h,b,e,c,j)}for(;a.lastChild!==d;)a.removeChild(a.lastChild)}},c.prototype._refreshCell=function(a,b,c,d,e){var f,g,h,i,j;g=c.column,a.style.textAlign=g._align||"",g.renderCell&&g.renderCell(a,b,d)!==!0||g.getListeners("renderCell")&&g.fire("renderCell",g,{item:b,dom:a,scope:d})===!1||this.getListeners("renderCell")&&this.fire("renderCell",this,{item:b,column:colInfo.column,dom:a,scope:d})===!1||(e&&(i=g._realTemplate,void 0===i&&(j=g._template,j&&(i=this._getTemplate(j)),g._realTemplate=i||null),i&&(i=this._cloneTemplate(i),a.appendChild(i),c.property&&(h={defaultPath:this._alias+"."+c.property}),cola.xRender(a,d,h))),g._realTemplate||(f=$fly(a),c.expression?f.attr("c-bind",c.expression.raw):f.text(c.property?b.get(c.property):"")))},c.prototype._refreshFakeRow=function(a){var b,c,d,e,f,g,h;for(g=a.firstChild,h=this._columnsInfo.dataColumns,d=e=0,f=h.length;f>e;d=++e)c=h[d],b=g,b?g=g.nextSibling:(b=$.xCreate({tagName:"td"}),a.appendChild(b));for(;g;)b=g,g=g.nextSibling,a.removeChild(b)},c.prototype._getFixedHeader=function(a){var b,c;return c=this._doms.fixedHeaderWrapper,!c&&a&&(c=$.xCreate({tagName:"div",contextKey:"fixedHeaderWrapper","class":"fixed-header table-wrapper",content:{tagName:"table",contextKey:"fixedHeaderTable"}},this._doms),this._dom.appendChild(c),this._doms.fakeThead=b=$.xCreate({tagName:"thead",content:{tagName:"tr"}}),this._refreshFakeRow(b.firstChild),$fly(this._doms.tbody).before(b)),c},c.prototype._getFixedFooter=function(a){var b,c;return c=this._doms.fixedFooterWrapper,!c&&a&&(c=$.xCreate({tagName:"div",contextKey:"fixedFooterWrapper","class":"fixed-footer table-wrapper",content:{tagName:"table",contextKey:"fixedFooterTable"}},this._doms),this._dom.appendChild(c,this._doms),this._doms.fakeTfoot=b=$.xCreate({tagName:"tfoot",content:{tagName:"tr"}}),this._refreshFakeRow(b.firstChild),$fly(this._doms.tbody).after(b)),c},c.prototype._refreshFixedColgroup=function(a,b){var c,d,e,f;for(e=a.firstChild,f=b.firstChild;e;)c=e,e=e.nextSibling,d=f,d?f=f.nextSibling:d=document.createElement("col"),d.width=c.width,d.valign=c.valign;for(;f;)d=f,f=f.nextSibling,b.removeChild(d)},c.prototype._setFixedHeaderSize=function(){var a,b;a=this._doms.colgroup,b=this._doms.fixedHeaderColgroup,b?this._refreshFixedColgroup(a,b):(this._doms.fixedHeaderColgroup=b=a.cloneNode(!0),this._doms.fixedHeaderTable.appendChild(b)),$fly(this._doms.fakeThead.firstChild).height(this._doms.thead.offsetHeight)},c.prototype._setFixedFooterSize=function(){var a,b;a=this._doms.colgroup,b=this._doms.fixedFooterColgroup,b?this._refreshFixedColgroup(a,b):(this._doms.fixedFooterColgroup=b=a.cloneNode(!0),this._doms.fixedFooterTable.appendChild(b)),$fly(this._doms.fakeTfoot.firstChild).height(this._doms.tfoot.offsetHeight)},c.prototype._refreshFixedHeader=function(){var a,b,c,d;b=this._doms.itemsWrapper,c=b.scrollTop,d=c>0,d!==this._fixedHeaderVisible&&(this._fixedHeaderVisible=d,d?(a=this._getFixedHeader(!0),this._setFixedHeaderSize(),$fly(this._doms.tbody).before(this._doms.fakeThead),this._doms.fixedHeaderTable.appendChild(this._doms.thead),$fly(a).width(b.clientWidth).show()):(a=this._getFixedHeader(),a&&($fly(a).hide(),this._doms.fixedHeaderTable.appendChild(this._doms.fakeThead),$fly(this._doms.tbody).before(this._doms.thead))))},c.prototype._refreshFixedFooter=function(a){var b,c,d,e,f,g;this._showFooterTimer&&(clearInterval(this._showFooterTimer),delete this._showFooterTimer),d=this._doms.itemsWrapper,f=d.scrollTop,e=d.scrollHeight-d.clientHeight,g=e>f,g!==this._fixedFooterVisible&&(this._fixedFooterVisible=g,g?(c=this._getFixedFooter(!0),this._setFixedFooterSize(),$fly(this._doms.tbody).after(this._doms.fakeTfoot),this._doms.fixedFooterTable.appendChild(this._doms.tfoot),b=$fly(c).width(d.clientWidth),a?b.fadeIn(a):b.show()):(c=this._getFixedFooter(),c&&($fly(c).hide(),this._doms.fixedFooterTable.appendChild(this._doms.fakeTfoot),$fly(this._doms.tbody).after(this._doms.tfoot))))},c.prototype._onItemsWrapperScroll=function(){this._showHeader&&this._refreshFixedHeader(),this._showFooter&&this._refreshFixedFooter()},c}(cola.ext.AbstractTable),cola.registerType("widget","ext.Table",cola.ext.Table)}).call(this);